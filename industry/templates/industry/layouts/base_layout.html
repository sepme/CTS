<!DOCTYPE html>
{% load static %}
{% load custom_tags %}
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock %}</title>
    <link rel="icon" sizes="16*16" href="{% static 'img/circle_logo.png' %}">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/css/swiper.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-tagsinput/1.3.6/jquery.tagsinput.min.css">
    <link rel="stylesheet" href="{% static 'css/comments.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'industry/css/style.css' %}">
</head>
<body class="{% if user.industryuser.status == 'signed_up' %}modal-open{% endif %}">
{% getUnseenMessages request.user as UnseenMessages %}
{% block dialog %}{% endblock %}
{% block modals %}{% endblock %}
<div class="modal fade" id="feedbackModal" data-backdrop="static" data-keyboard="false" tabindex="-1"
     role="dialog" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">ثبت بازخورد</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'chamran:addOpinion' %}" id="feedback_ajax_form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="feedbackEmail">پست الکترونیکی</label>
                        <input type="email" name='email' class="form-control" id="feedbackEmail"
                               aria-describedby="emailHelp">
                    </div>
                    <div class="form-group">
                        <label for="feedbackOpinion">متن مشکل</label>
                        <textarea name='opinion' class="form-control" id="feedbackOpinion" rows="4"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">ارسال</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="main">
    <div class="top-bar">
        <img src="{% static 'industry/img/logoName.png' %}" alt="chamranTeam">
        <div class="dropdown">
            <button type="button" name="button" class="btn dropdown-toggle" id="dropdown-btn" data-toggle="dropdown">
                <img
                        {% if user.industryuser.profile.photo %}
                            src="{{ user.industryuser.profile.photo.url }}"
                        {% else %}
                            src="{% static 'industry/img/profile.jpg' %}"
                        {% endif %}
                            alt="profile" class="dropdown-img profile" height="45px">
                <!-- {% if request.user.industryuser.profile.photo %}
                    <img src="{{ request.user.industryuser.profile.photo.url }}" alt="profile"
                         class="dropdown-img profile"
                         height="45px">
                {% else %}
                    <img src="{% static 'industry/img/profile.jpg' %}" alt="profile" class="dropdown-img profile"
                         height="45px">
                {% endif %} -->
            </button>
            <ul class="dropdown-menu text-center" role="menu" aria-labelledby="dropdown-btn" id="dropdown">
                <li><a href="{% url 'industry:userInfo' %}">اطلاعات کاربری<i class="fas fa-cog"></i></a></li>
                <li><a href="{% url 'chamran:send_reset_email' %}">تغییر رمز عبور<i class="fas fa-pen"></i></a></li>
                <hr>
                <li><a href="{% url 'chamran:logout' %}">خروج<i class="fas fa-sign-out-alt"></i></a></li>
            </ul>
        </div>
        <div class="feed-back">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#feedbackModal">
                <i class="fas fa-edit"></i>
            </button>
        </div>
        <a href="#" id="toggle"><span></span></a>
    </div>
    <div class="content">
        <div class="container">
            <div id="top"></div>
            {% block content %}{% endblock %}
        </div>
    </div>
    <div class="side-bar">
        <div class="topMargin"></div>
        <div class="expert-icon"></div>
        <img
                {% if user.industryuser.profile.photo %}
                    src="{{ user.industryuser.profile.photo.url }}"
                {% else %}
                    src="{% static 'industry/img/profile.jpg' %}"
                {% endif %}
                    alt="profile" class="profile" width="150px" height="150px">
        <!-- {% if request.user.industryuser.profile.photo %}
            <img src="{{ request.user.industryuser.profile.photo.url }}" alt="profile"
                    class="dropdown-img profile"
                    height="45px">
        {% else %}
            <img src="{% static 'industry/img/profile.jpg' %}" alt="profile" class="dropdown-img profile"
                    height="45px">
        {% endif %} -->
        <h5 class="fc-white">{% block name %}{% endblock %}</h5>
        <h6>
            {% if request.user.industryuser.industry_type == "R&D" %}
                واحد تحقیق و توسعه
            {% else %}
                مجموعه پژوهشی
            {% endif %}
        </h6>
        {#        <p dir="rtl" class="scoreDiv text-right">امتیاز: <span>{{ user.industryuser.industry_points|default:0 }}</span>/10#}
        {#        </p>#}
        {#        <div class="progress">#}
        {#            <div class="progress-bar" role="progressbar" aria-valuenow="{{ user.industryuser.score|default:0 }}"#}
        {#                 aria-valuemin="0"#}
        {#                 aria-valuemax="100" style="width: {{ user.industryuser.score }}px">#}
        {#                <span class="sr-only">{{ user.industryuser.score|default:0 }}% completed</span>#}
        {#            </div>#}
        {#        </div>#}
        <div class="hr"></div>
        <ul class="list-group">
            {% url "industry:index" as index %}
            <a href='{{ index }}'>
                <li class="list-group-item text-right {% if request.get_full_path == index %}active{% endif %}">
                    <div>
                        <span>پروژه ها</span>
                        <span class="fas fa-list-ul"></span>
                    </div>
                </li>
            </a>
            {% url "industry:messages" as messages %}
            <a href="{{ messages }}">
                <li class="list-group-item text-right {% if request.get_full_path == messages %}active{% endif %}">
                    <div>
                        {% if UnseenMessages %}
                            <span class="new-message">{{ UnseenMessages }}</span>
                        {% endif %}
                        <span>پیام ها</span>
                        <span class="fas fa-envelope"></span>
                    </div>
                </li>
            </a>
            {% url "industry:newProject" as newProject %}
            <a href='{{ newProject }}'>
                <li class="list-group-item text-right {% if request.get_full_path == newProject %}active{% endif %}">
                    <div>
                        <span>ثبت پروژه جدید</span>
                        <span class="fas fa-plus-circle"></span>
                    </div>
                </li>
            </a>
            {#            TODO#}
            <!-- <li class="list-group-item text-right">
                <a href="#">
                    <div>
                        <span>درخواست ها</span>
                        <span class="fas fa-sticky-note"></span>
                    </div>
                </a>
            </li> -->
            {% url 'industry:userInfo' as userInfo %}
            <li class="list-group-item text-right {% if request.get_full_path == userInfo %}active{% endif %}">
                <a href="{{ userInfo }}">
                    <div>
                        <span>اطلاعات کاربری</span>
                        <span class="fas fa-cog"></span>
                    </div>
                </a>
            </li>
        </ul>
        <div class="hr display-sm"></div>
        <ul class="list-group display-sm">
            <a href="{% url 'chamran:send_reset_email' %}">
                <li class="list-group-item text-right">
                    <div>
                        <span>تغییر رمز عبور</span>
                        <i class="fas fa-lock"></i>
                    </div>
                </li>
            </a>
            <a href="{% url 'chamran:logout' %}">
                <li class="list-group-item text-right">
                    <div>
                        <span>خروج</span>
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </li>
            </a>
        </ul>
    </div>
</div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/js/swiper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-tagsinput/1.3.6/jquery.tagsinput.min.js"></script>
<script type="text/javascript" src="{% static 'js/persianumber.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/autosize.min.js' %}"></script>
{% block script %}{% endblock %}
<script type="text/javascript" src="{% static 'js/script-functions.js' %}"></script>
<script type="text/javascript" src="{% static 'industry/js/script-functions.js' %}"></script>
<script type="text/javascript" src="{% static 'industry/js/script.js' %}"></script>
{% if user.industryuser.status == 'signed_up' %}
    <div class="modal-backdrop fade show" style="user-select: auto;"></div>
    <script type="text/javascript">
        $("input.error, select.error").prev().css("color", "rgb(255,69,69)");
        display_error($("#exampleModal form"));
    </script>
    <script type="text/javascript">
        $(window).on("load", function () {
            const initialInformation = $('#initialInformation');
            const selectUsage = $(".select-usage");
            const industryForm = $(".industry-form");
            $('.select-usage .form-check label.form-check-label').click(function () {
                $(".select-usage svg > g").attr("fill", "#808080");
                $(this).find("svg > g").attr("fill", "#3ccd1c");
                $(".select-usage button").prop("disabled", false);
            });

            initialInformation.modal('toggle');

            $(".select-usage button").click(function () {
                if (selectUsage.find("input[type='radio']:checked").val() === "industry") {
                    {#$('#selectUsage').modal('toggle');#}
                    {#$('#initialInformation').modal('toggle');#}
                    {#$('#initialInformation form').find("input[name='industry_type']").attr("value", "industry");#}
                    $(".select-usage").addClass("d-none");
                    $(".industry-form").removeClass("d-none");
                    $(".RandD__form-item").css("display", "block");
                    initialInformation.find(".initial-step-dots div").removeClass("active");
                    initialInformation.find(".initial-step-dots div:nth-child(2)").addClass("active");
                } else if (selectUsage.find("input[type='radio']:checked").val() === "research_group") {
                    {#$('#selectUsage').modal('toggle');#}
                    {#$('#initialInformation').modal('toggle');#}
                    {#$('#initialInformation form').find("input[name='industry_type']").attr("value", "group");#}
                    $(".select-usage").addClass("d-none");
                    $(".industry-form").removeClass("d-none");
                    initialInformation.find(".initial-step-dots div").removeClass("active");
                    initialInformation.find(".initial-step-dots div:nth-child(2)").addClass("active");
                    $(".RGroup__form-item").css("display", "block");
                } else {
                    iziToast.error({
                        rtl: true,
                        message: "لطفا یکی از گزینه های بالا را انتخاب کنید!",
                        position: 'bottomLeft'
                    });
                }
            });

            $('#initialInformation .back-step').click(function () {
                if ($(".industry-form").hasClass("state-2")) {
                    $(".RandD__form-item").css("display", "none");
                    $(".RGroup__form-item").css("display", "none");
                    $(".select-usage").removeClass("d-none");
                    $(".industry-form").addClass("d-none");
                    initialInformation.find(".initial-step-dots div").removeClass("active");
                    initialInformation.find(".initial-step-dots div:first-child").addClass("active");
                } else if ($(".industry-form").hasClass("state-3")) {
                    industryForm.addClass("state-2");
                    industryForm.removeClass("state-3");
                    $('#initialInformation .next-step').removeClass("d-none");
                    industryForm.find("button[type='submit']").addClass("d-none");
                    $(".third-step-view").addClass("d-none");
                    $(".second-step-view").removeClass("d-none");
                    initialInformation.find(".initial-step-dots div").removeClass("active");
                    initialInformation.find(".initial-step-dots div:nth-child(2)").addClass("active");
                }
            });

            $('#initialInformation .next-step').click(function () {
                if (industryForm.hasClass("state-2")) {
                    industryForm.addClass("state-3");
                    industryForm.removeClass("state-2");
                    $('#initialInformation .next-step').addClass("d-none");
                    industryForm.find("button[type='submit']").removeClass("d-none");
                    $(".third-step-view").removeClass("d-none");
                    $(".second-step-view").addClass("d-none");
                    initialInformation.find(".initial-step-dots div").removeClass("active");
                    initialInformation.find(".initial-step-dots div:last-child").addClass("active");
                }
            });

        });

    </script>
{% endif %}
<script type="text/javascript">
    $("form#feedback_ajax_form").submit(function (event) {
        event.preventDefault();
        $.ajax({
            method: "POST",
            url: $(this).attr("action"),
            data: $(this).serialize(),
            success: function (data) {
                iziToast.success({
                    rtl: true,
                    message: "بازخورد شما با موفقیت ارسال شد!",
                    position: 'bottomLeft'
                });
                $("form#feedback_ajax_form")[0].reset()
            },
            error: function (data) {
                console.log(data);
                iziToast.error({
                    rtl: true,
                    message: "ارسال بازخورد با خطا مواجه شد!",
                    position: 'bottomLeft'
                });
            }
        });
    });
</script>
</body>
</html>
