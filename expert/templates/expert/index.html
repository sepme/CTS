{% extends "expert/layouts/base_layout.html" %}
{% load static %}
{% load date_tags %}
{% load message_tags %}
{% block title %}پروژه ها{% endblock %}

{% block name %} {{ request.user.expertuser.expertform }}{% endblock %}

{% block dialog %}
    {% include 'expert/layouts/vote_dialog_industry.html' %}
    {% include 'expert/layouts/vote_dialog_researcher.html' %}
    {% include 'expert/layouts/select_techniques.html' %}
{% endblock %}
{% block modals %}
    {% if request.user.expertuser.status == 'signed_up' %}
        {% include 'expert/layouts/initial_information.html' %}
    {% endif %}
    {# {% with projects|first as project %} #}
    {% if project.status != 2 %}
        {#{% include 'expert/layouts/project_details.html' %}#}
        {#{% else %}#}
        {% include 'expert/layouts/showProject.html' %}
    {% endif %}
    {# {% endwith %} #}
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-12 text-right">
            <h3 class="h3 p-top-15">پروژه ها</h3>
        </div>
    </div>
    <div class="row">
        {% if request.user.expertuser.status != 'signed_up' %}
            <div class="col-lg-12 text-right">
                <nav class="nav-tabs-container">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active fs-15" id="nav-all-projects-tab" data-toggle="tab"
                           href="#nav-all-projects" role="tab" aria-controls="nav-personal-info" aria-selected="true">
                            جدیدترین پروژه ها
                        </a>
                        <a class="nav-item nav-link fs-15" id="nav-applied-projects-tab" data-toggle="tab"
                           href="#nav-applied-projects" role="tab" aria-controls="nav-resume" aria-selected="false">
                            درخواست داده شده
                        </a>
                        <a class="nav-item nav-link fs-15" id="nav-active-projects-tab" data-toggle="tab"
                           href="#nav-active-projects" role="tab" aria-controls="nav-upload" aria-selected="false">
                            در حال انجام
                        </a>
                        <a class="nav-item nav-link fs-15" id="nav-done-projects-tab" data-toggle="tab"
                           href="#nav-done-projects" role="tab" aria-controls="nav-upload" aria-selected="false">
                            انجام شده ها
                        </a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-all-projects" role="tabpanel"
                         aria-labelledby="nav-personal-info-tab">
                        {% for project in newProjects %}
                            <div class="card box flow-root-display w-100">
                                <div class="box-header">
                                    <h6>
                                        {{ project.project_form.persian_title }}
                                    </h6>
                                    {% calculate_date_past project.date_submitted_by_industry as date_past %}
                                    <div class="data-modified">
                                        <span>{{ date_past }} قبل </span>
                                    </div>
                                    <div class="notification">
                                        <i class="far fa-comment-alt center-abs"></i>
                                        {% getUnseenComments project.pk request.user.expertuser as UnseenComments %}
                                        {% if UnseenComments != 0 %}
                                            <span class="unseen-comments"> {{ UnseenComments }} </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-6 col-9">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="date text-center">
                                                        <div class="label">مهلت</div>
                                                        <div class="value">
                                                            <span>{% calculate_date_remaining project.date_finished %}</span>
                                                            <!-- <span>3</span>
                                                            <span>روز</span> -->
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="status text-center">
                                                        <div class="label">بودجه</div>
                                                        <div class="value">
                                                            <span>{{ project.project_form.required_budget }}</span>
                                                            <span>ریال</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-3">
                                            <button class="default-btn preview-project type-{{ project.status }}"
                                                    id={{ project.pk }}
                                                            data-url="{% url 'expert:show_project' %}"
                                                    data-toggle="modal"
                                                    data-target="#showProject">
                                                مشاهده
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="no-project-container">
                                <div class="no-project">
                                    <img src="{% static 'img/no_project.svg' %}" alt="logo" class="icon">
                                    <h4>متاسفانه، هنوز پروژه ای مرتبط با تخصص شما ثبت نشده است!</h4>
                                    <p>پیشنهاد می کنیم دست از کار نکشید و با کلیک بر روی</p>
                                    <span>
                                    <i class="fas fa-cog"></i>
                                    <span>اطلاعات کاربری</span>
                                </span>
                                    <p>
                                        رزومه خود را کامل کنید تا در هنگام ارسال درخواست انجام پروژه، صنایع با شناخت
                                        و
                                        اطمینان کامل، پروژه شان را به شما بسپارند.
                                    </p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="nav-applied-projects" role="tabpanel"
                         aria-labelledby="nav-applied-projects-tab">
                        {% for project in appliedProjects %}
                            <div class="card box flow-root-display w-100">
                                <div class="box-header">
                                    <h6>
                                        {{ project.project_form.persian_title }}
                                    </h6>
                                    {% calculate_date_past project.date_submitted_by_industry as date_past %}
                                    <div class="data-modified">
                                        <span>{{ date_past }} قبل </span>
                                    </div>
                                    <div class="notification">
                                        <i class="far fa-comment-alt center-abs"></i>
                                        {% getUnseenComments project.pk request.user.expertuser as UnseenComments %}
                                        {% if UnseenComments != 0 %}
                                            <span class="unseen-comments"> {{ UnseenComments }} </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-6 col-9">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="date text-center">
                                                        <div class="label">مهلت</div>
                                                        <div class="value">
                                                            <span>{% calculate_date_remaining project.date_finished %}</span>
                                                            <!-- <span>3</span>
                                                            <span>روز</span> -->
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="status text-center">
                                                        <div class="label">بودجه</div>
                                                        <div class="value">
                                                            <span>{{ project.project_form.required_budget }}</span>
                                                            <span>ریال</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-3">
                                            <button class="default-btn preview-project type-{{ project.status }}"
                                                    id={{ project.pk }}
                                                            data-url="{% url 'expert:show_project' %}"
                                                    data-toggle="modal"
                                                    data-target="#showProject">
                                                مشاهده
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="col-12 text-center">
                                <div class="empty-page">
                                    <div class="empty-page-container">
                                        <img src="{% static 'img/packet.svg' %}" alt="">
                                        <h5>درخواستی برای پروژه ای ثبت نکرده اید!</h5>
                                        <pre>می توانید در قسمت «جدیدترین پروژه ها» درخواست خود را برای پروژه ثبت کنید و اطلاعات آنرا در این قسمت مشاهده کنید.</pre>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="nav-active-projects" role="tabpanel"
                         aria-labelledby="nav-active-projects-tab">
                        {% for project in activeProjects %}
                            <div class="card box flow-root-display w-100">
                                <div class="box-header">
                                    <h6>
                                        {{ project.project_form.persian_title }}
                                    </h6>
                                    {% calculate_date_past project.date_submitted_by_industry as date_past %}
                                    <div class="data-modified">
                                        <span>{{ date_past }} قبل </span>
                                    </div>
                                    <div class="notification">
                                        <i class="far fa-comment-alt center-abs"></i>
                                        {% getUnseenComments project.pk request.user.expertuser as UnseenComments %}
                                        {% if UnseenComments != 0 %}
                                            <span class="unseen-comments"> {{ UnseenComments }} </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-6 col-9">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="date text-center">
                                                        <div class="label">مهلت</div>
                                                        <div class="value">
                                                            <span>{% calculate_date_remaining project.date_finished %}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="status text-center">
                                                        <div class="label">بودجه</div>
                                                        <div class="value">
                                                            <span>{{ project.project_form.required_budget }}</span>
                                                            <span>ریال</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-3">
                                            <a href="{% url 'expert:show_active_project' code=project.code %}">
                                                <button class="default-btn" type="button">
                                                    مشاهده
                                                </button>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="col-12 text-center">
                                <div class="empty-page">
                                    <div class="empty-page-container">
                                        <img src="{% static 'img/packet.svg' %}" alt="">
                                        <h5>پروژه در حال انجامی ندارید!</h5>
                                        <pre>می توانید در قسمت «جدیدترین پروژه ها» درخواست خود را برای پروژه ثبت کنید و پس از تایید اطلاعات آنرا در این قسمت مشاهده خواهید کرد.</pre>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="nav-done-projects" role="tabpanel"
                         aria-labelledby="nav-done-projects-tab">
                        {% for project in doneProjects %}
                            <div class="card box flow-root-display w-100">
                                <div class="box-header">
                                    <h6>
                                        {{ project.project_form.persian_title }}
                                    </h6>
                                    {% calculate_date_past project.date_submitted_by_industry as date_past %}
                                    <div class="data-modified">
                                        <span>{{ date_past }} قبل </span>
                                    </div>
                                    <div class="notification">
                                        <i class="far fa-comment-alt center-abs"></i>
                                        {% getUnseenComments project.pk request.user.expertuser as UnseenComments %}
                                        {% if UnseenComments != 0 %}
                                            <span class="unseen-comments"> {{ UnseenComments }} </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-6 col-9">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="date text-center">
                                                        <div class="label">مهلت</div>
                                                        <div class="value">
                                                            <span>{% calculate_date_remaining project.date_finished %}</span>
                                                            <!-- <span>3</span>
                                                            <span>روز</span> -->
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="status text-center">
                                                        <div class="label">بودجه</div>
                                                        <div class="value">
                                                            <span>{{ project.project_form.required_budget }}</span>
                                                            <span>ریال</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-3">
                                            <button class="default-btn preview-project type-{{ project.status }}"
                                                    id={{ project.pk }}
                                                            data-url="{% url 'expert:show_project' %}"
                                                    data-toggle="modal"
                                                    data-target="#showProject">
                                                مشاهده
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="col-12 text-center">
                                <div class="empty-page">
                                    <div class="empty-page-container">
                                        <img src="{% static 'img/packet.svg' %}" alt="">
                                        <h5>پروژه تکمیل شده ای ندارید!</h5>
                                        <pre>می توانید در قسمت «جدیدترین پروژه ها» درخواست خود را برای پروژه ثبت کنید و پس از تایید و تکمیل پروژه اطلاعات آنرا در این قسمت مشاهده خواهید کرد.</pre>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {#        <div class="col-lg-3">col-lg-3</div>#}
        {% endif %}
    </div>
    <a href="#top" class="top-button">
        <i class="fas fa-angle-up"></i>
    </a>
{% endblock %}
{% block script %}
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    {#    <script src="{% static 'js/inputTags.jquery.min.js' %}" type="text/javascript"></script>#}
    {% if project.status == 2 %}

        <script type="text/javascript">
            $("#v-pills-roles-tab").click(function () {
                let role = "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "از لحاظ نکات اخلاقی (کار با نمونه انسانی، حیوانی، مواد رادیواکتیو و...)، پروژه شما با چه چالش هایی روبه رو است؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.policy }}" +
                    "</div>" +
                    "</div>";
                $(".project-info-content").html(role);
                $('*').persiaNumber();
            });
            $("#v-pills-resources-tab").click(function () {
                let resources = "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "جهت انجام پروژه خود به چه امکانات یا آزمایشگاه هایی احتیاج دارید؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.required_lab_equipment }}" +
                    "</div>" +
                    "</div>" +
                    "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "جهت انجام پروژه خود به چه تخصص ها و چه تکنیک ها آزمایشگاهی ای احتیاج دارید؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.required_method }}" +
                    "</div>" +
                    "</div>" +
                    "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "لطفا مراحل انجام پروژه خود را مشخص کنید." +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.project_phase }}" +
                    "</div>" +
                    "</div>" +
                    "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "پروژه شما به چه مقدار بودجه نیاز دارد؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    numbersComma("{{ project.project_form.required_budget }}") + " ریال" +
                    "</div>" +
                    "</div>";
                $(".project-info-content").html(resources);
                $('*').persiaNumber();
            });
            $("#v-pills-approaches-tab").click(function () {
                let approach = "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "لطفا راه حل خود را برای حل این مشکل به طور خلاصه توضیح دهید." +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.approach }}" +
                    "</div>" +
                    "</div>" +
                    "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "این راه حل چه مشکلاتی می‌تواند داشته باشد؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.potential_problems }}" +
                    "</div></div>";
                $(".project-info-content").html(approach);
                $('*').persiaNumber();
            });
            $("#v-pills-majors-tab").click(function () {
                let majors = "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "لطفا مشکل اصلی که پروژه به حل آن پرداخته را توضیح و اهمیت آن را تبیین کنید." +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.main_problem_and_importance }}" +
                    "</div></div>" +
                    "<div>" +
                    "<div class='question'>" +
                    "<span class='question-mark'>" +
                    "<i class='far fa-question-circle'></i>" +
                    "</span>" +
                    "در صورت حل این مشکل، چه پیشرفتی در شیوه های درمانی / تجهیزات پزشکی / خدمات درمانی یا ... حاصل می شود؟" +
                    "</div>" +
                    "<div class='answer'>" +
                    "{{ project.project_form.progress_profitability }}" +
                    "</div></div>";
                $(".project-info-content").html(majors);
                $('*').persiaNumber();
            });
            //"<div>" +
            //        "<div class='question'>" +
            //        "<span class='question-mark'>" +
            //        "<i class='far fa-question-circle'></i>" +
            //        "</span>" +
            //        "برآورد شما از سود مالی این پروژه چگونه است؟" +
            //        "</div>" +
            //        "<div class='answer'>" +
            //        numbersComma("{{ project.project_form.predict_profit }}") + " ریال" +
            //        "</div></div>";
        </script>
        <script type="text/javascript">
            $(".comments .fa-trash-alt").closest(".dropdown-item").click(function () {
                deleteComment($(this).closest('.my-comment'));
            });
            dialog_comment_init();
            $('.owl-carousel').owlCarousel({
                stagePadding: 50,
                loop: false,
                margin: 20,
                nav: false,
                dots: true,
                rtl: true,
                responsive: {
                    0: {
                        items: 1
                    },
                    600: {
                        items: 3
                    },
                    1000: {
                        items: 3
                    }
                }
            });
        </script>
    {% endif %}
{% endblock %}